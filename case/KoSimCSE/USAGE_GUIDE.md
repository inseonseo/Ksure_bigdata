# 사고 유사도 검색 시스템 사용 가이드

## 🚀 시스템 개요

이 시스템은 KoSimCSE 기반 텍스트 유사도 분석을 통해 유사한 사고 사례를 검색하는 도구입니다.

### 주요 기능
- **KoSimCSE 기반 텍스트 유사도**: 사고설명의 맥락을 정확히 이해
- **다중 특성 유사도**: 텍스트, 범주형, 수치형 데이터 종합 분석
- **캐싱 시스템**: 임베딩 재사용으로 빠른 검색
- **예측 결과**: 유사 사례 기반 판정구분/판정사유 예측

## 📋 필수 입력 정보

### 기본 입력 필드
1. **사고유형명** (드롭다운): 사고의 유형 선택
2. **수입국** (드롭다운): 수입국 선택
3. **보험종목** (드롭다운): 보험 종목 선택
4. **수출자** (텍스트): 수출자명 입력
5. **사고설명** (텍스트): 사고 내용 상세 설명

### 선택 입력 필드
- **신청대상구분** (드롭다운)
- **신청자** (텍스트)
- **사고경위** (텍스트)

## 🔍 검색 방법

### 1. 웹 인터페이스 사용
```bash
cd KoSimCSE
streamlit run web_interface.py
```

### 2. 명령줄 테스트
```bash
cd KoSimCSE
python test_current_system.py
```

### 3. 샘플 데이터 테스트 (빠른 테스트)
```bash
cd KoSimCSE
python sample_test.py
```

## 💡 검색 팁

### 수출자 입력 방법
1. **기존 수출자**: 정확한 회사명 입력
2. **신규 수출자**: 업종 기반 추정
   - 예: "신생 전자제품 수출업체"
   - 예: "신규 섬유 수출업체"
   - 예: "신생 자동차부품 수출업체"

### 사고설명 작성 방법
1. **구체적이고 상세하게**: 사고의 원인, 과정, 결과 포함
2. **업종 정보 포함**: 수출 품목이나 업종 정보 포함
3. **문제 상황 명시**: 지급거절, 품질문제, 지연 등

### 예시 검색 쿼리
```python
query = {
    '사고유형명': '지급거절',
    '수입국': '미국',
    '보험종목': '단기수출보험',
    '사고설명': '수입자가 품질 문제를 이유로 지급을 거절함. 신생 업체의 첫 수출 건에서 발생한 문제입니다.',
    '수출자': '신생 전자제품 수출업체'
}
```

## 📊 검색 결과 해석

### 유사도 점수
- **0.8 이상**: 매우 유사한 사례
- **0.6-0.8**: 유사한 사례
- **0.4-0.6**: 부분적으로 유사한 사례
- **0.4 미만**: 낮은 유사도

### 예측 결과
- **판정구분**: 지급, 면책, 부분지급 등
- **판정사유**: 구체적인 판정 이유

### 판정 과정
- 각 사례의 전체 판정 과정 표시
- 시간순으로 정렬된 판정 이력
- 최종 판정 결과와 중간 과정 모두 확인 가능

## ⚡ 성능 최적화

### 첫 실행 시
- KoSimCSE 임베딩 생성: 약 2-3시간 소요
- 진행률과 남은 시간 표시
- 캐시 파일 자동 저장

### 이후 실행 시
- 캐시된 임베딩 사용: 빠른 시작
- 데이터 변경 시 자동 재생성

### 빠른 테스트 모드
```python
search_engine = CaseSimilaritySearch(fast_mode=True)  # KoSimCSE 생략
```

## 🔧 문제 해결

### 사고유형명 드롭다운이 비어있는 경우
1. 데이터 파일 경로 확인: `data/testy.csv`
2. 데이터 파일 인코딩 확인: `cp949`
3. `사고유형명` 컬럼 존재 확인

### KoSimCSE 모델 로드 실패
1. 인터넷 연결 확인
2. `torch`, `transformers` 패키지 설치 확인
3. GPU 메모리 부족 시 CPU 모드로 전환

### 검색 결과가 없는 경우
1. 입력 조건 완화
2. 더 일반적인 키워드 사용
3. 사고설명을 더 상세하게 작성

## 📈 시스템 성능

### 유사도 계산 가중치
- **텍스트 유사도 (KoSimCSE)**: 70%
- **범주형 유사도**: 25%
- **수치형 유사도**: 5%

### 검색 속도
- **캐시 사용 시**: 1-2초
- **첫 실행 시**: 임베딩 생성 시간 + 1-2초

## 🎯 사용 시나리오

### 1. 신규 사고 접수 시
- 유사한 과거 사례 검색
- 예상 판정 결과 확인
- 판정 과정 참고

### 2. 판정 검토 시
- 유사 사례의 판정 패턴 분석
- 판정 근거 참고
- 일관성 확인

### 3. 교육/훈련 시
- 다양한 사고 유형 학습
- 판정 과정 이해
- 사례 연구

## 📞 지원

문제가 발생하거나 개선 사항이 있으시면:
1. `test_current_system.py` 실행하여 시스템 상태 확인
2. 로그 메시지 확인
3. 데이터 파일 및 설정 확인 