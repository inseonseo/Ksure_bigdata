# 🔍 사고 유사도 검색 시스템

## 📋 개요

이 시스템은 `testy.csv` 데이터를 기반으로 유사한 사고 사례를 검색하고, **KoSimCSE**를 사용하여 사고설명의 의미적 유사도를 계산하는 웹 애플리케이션입니다.

## ✨ 주요 기능

### 🔍 유사도 검색
- **다양한 입력 방식**: 드롭다운, 텍스트 입력, 텍스트 영역
- **유연한 검색**: 기본 정보부터 상세 정보까지 단계별 입력
- **고급 필터링**: 판정 패턴, 최소 유사도, 판정 횟수 등

### 🤖 KoSimCSE 기반 텍스트 유사도
- **의미적 유사도**: 사고설명의 의미를 이해하여 유사도 계산
- **한국어 최적화**: 한국어 텍스트에 특화된 임베딩 모델
- **고정밀 매칭**: 단순 키워드가 아닌 의미 기반 매칭

### 📊 판정 과정 분석
- **사건별 그룹핑**: 같은 사고의 모든 판정을 하나로 묶어서 분석
- **패턴 분류**: 단일판정, 면책지급_혼재, 동일판정_반복 등
- **상세 과정**: 각 판정의 날짜, 구분, 금액, 사유, 상태 표시

### 🌐 웹 인터페이스
- **직관적인 UI**: Streamlit 기반의 사용자 친화적 인터페이스
- **실시간 시각화**: 판정 패턴 분포, 통계 정보 등
- **반응형 디자인**: 다양한 화면 크기에 대응

## 🏗️ 시스템 구조

```
KoSimCSE/
├── case_similarity_search.py    # 핵심 검색 엔진 (KoSimCSE 포함)
├── web_interface.py            # 웹 인터페이스
├── run_web_app.py             # 웹 앱 실행 스크립트
├── data/
│   └── testy.csv              # 테스트 데이터
└── README_CASE_SEARCH.md      # 이 파일
```

## 🚀 설치 및 실행

### 1. 의존성 설치
```bash
pip install streamlit pandas numpy scikit-learn plotly torch transformers
```

### 2. 데이터 준비
```bash
# testy.csv 파일을 data 폴더에 넣어주세요
cp testy.csv data/
```

### 3. 웹 애플리케이션 실행
```bash
# 방법 1: 실행 스크립트 사용
python run_web_app.py

# 방법 2: 직접 Streamlit 실행
streamlit run web_interface.py
```

### 4. 브라우저에서 접속
```
http://localhost:8501
```

## 📝 사용 방법

### 1. 간단 입력 (빠른 검색)
- **사고유형**: 드롭다운에서 선택
- **수입국**: 드롭다운에서 선택
- **보험종목**: 드롭다운에서 선택
- **수출자**: 텍스트 입력
- **사고설명**: 간단한 텍스트 입력 (KoSimCSE로 의미적 유사도 계산)

### 2. 상세 입력 (정확한 검색)
- 기본 정보 + 추가 정보
- **사고금액**: 숫자 입력
- **결제금액**: 숫자 입력
- **사고경위**: 상세 텍스트 입력

### 3. 고급 검색 (필터링)
- **검색 결과 수**: 1-20개 선택
- **최소 유사도**: 0.0-1.0 설정
- **판정 패턴 필터**: 특정 패턴만 검색
- **최소 판정 횟수**: 설정

## 🔧 기술적 특징

### 데이터 처리
- **testy.csv 사용**: 실제 테스트 데이터 활용
- **유연한 컬럼 처리**: 다양한 컬럼 구조에 대응
- **판정 패턴 분석**: 자동 분류 및 요약

### KoSimCSE 텍스트 유사도
- **의미적 임베딩**: 한국어 텍스트의 의미를 벡터로 변환
- **코사인 유사도**: 임베딩 간 코사인 유사도 계산
- **배치 처리**: 효율적인 대량 텍스트 처리

### 유사도 계산
- **텍스트 유사도**: KoSimCSE 기반 (60% 가중치)
- **범주형 유사도**: 정확 일치 기반 (30% 가중치)
- **수치형 유사도**: 유클리드 거리 기반 (10% 가중치)

### 성능 최적화
- **캐싱**: Streamlit 캐시 활용
- **배치 처리**: KoSimCSE 임베딩 배치 생성
- **메모리 효율성**: 필요한 데이터만 로드

## 📊 출력 결과

### 검색 결과 요약
- 총 검색 결과 수
- 평균 유사도
- 가장 많은 판정 패턴
- 평균 판정 횟수

### 개별 사례 상세 정보
- **사건 정보**: 접수일자, 유형, 국가, 금액 등
- **판정 요약**: 패턴, 요약, 횟수
- **판정 과정**: 각 차례별 상세 정보

### 시각화
- **판정 패턴 분포**: 파이 차트
- **통계 정보**: 메트릭 박스
- **상세 과정**: 확장 가능한 카드

## 🎯 비즈니스 가치

### 의사결정 지원
- **유사 사례 참고**: 과거 판정 과정을 통한 의사결정 지원
- **패턴 인식**: 어떤 경우에 재심사가 이루어지는지 파악
- **위험 평가**: 유사한 사고의 최종 판정 결과 예측

### 투명성 향상
- **판정 과정 공개**: 모든 판정 단계를 투명하게 표시
- **근거 제시**: 유사도 점수와 함께 근거 제공
- **일관성 확보**: 동일한 기준으로 유사 사례 검색

### 효율성 증대
- **빠른 검색**: 복잡한 조건도 빠르게 처리
- **직관적 인터페이스**: 전문가가 아닌 사용자도 쉽게 사용
- **자동화**: 수동 검색 대비 시간 단축

## 🔒 데이터 보안

### 데이터 유출 방지
- **사건 단위 분할**: 같은 사건의 모든 판정이 같은 세트에 포함
- **시간적 일관성**: 과거 데이터로 미래 예측
- **접근 제어**: 로컬 환경에서만 실행

### 개인정보 보호
- **식별 정보 제거**: 개인을 특정할 수 있는 정보 제거
- **집계 데이터**: 개별 사례가 아닌 패턴 중심 분석
- **암호화**: 민감한 데이터 암호화 저장

## 🛠️ 개발 환경

### 요구사항
- Python 3.8+
- 8GB+ RAM (대용량 데이터 처리)
- 웹 브라우저 (Chrome, Firefox, Safari)
- GPU 권장 (KoSimCSE 가속)

### 권장사항
- SSD 저장장치 (빠른 데이터 로딩)
- 멀티코어 CPU (병렬 처리)
- 고해상도 모니터 (차트 표시)
- CUDA 지원 GPU (KoSimCSE 가속)

## 📞 지원 및 문의

### 문제 해결
1. **데이터 로드 오류**: `testy.csv` 파일 경로 확인
2. **패키지 오류**: `pip install` 명령어로 재설치
3. **메모리 부족**: 데이터 크기 줄이거나 RAM 증설
4. **KoSimCSE 오류**: 모델 경로 및 의존성 확인

### 기능 개선
- 새로운 유사도 알고리즘 추가
- 추가 시각화 기능
- API 인터페이스 개발
- 모바일 최적화
- KoSimCSE 모델 최적화

## 📄 라이선스

이 프로젝트는 내부 사용 목적으로 개발되었습니다. 